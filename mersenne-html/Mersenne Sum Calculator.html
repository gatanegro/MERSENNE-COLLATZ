<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mersenne Sum Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }
        
        body {
            background: #0a192f;
            color: #64ffda;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #112240;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #64ffda;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #64ffda;
        }
        
        .subtitle {
            text-align: center;
            color: #8892b0;
            margin-bottom: 30px;
        }
        
        .main-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .main-area {
                grid-template-columns: 1fr;
            }
        }
        
        .calculator {
            background: #0a192f;
            padding: 25px;
            border-radius: 10px;
            border: 2px solid #233554;
        }
        
        .results {
            background: #0a192f;
            padding: 25px;
            border-radius: 10px;
            border: 2px solid #233554;
        }
        
        .section-title {
            color: #64ffda;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #64ffda;
        }
        
        /* MERSEENNE NAVIGATION */
        .mersenne-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(10, 25, 47, 0.8);
            border-radius: 5px;
        }
        
        .mersenne-btn {
            padding: 8px 15px;
            background: #233554;
            color: #64ffda;
            border: 1px solid #64ffda;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            min-width: 70px;
            text-align: center;
        }
        
        .mersenne-btn:hover {
            background: #64ffda;
            color: #0a192f;
        }
        
        .mersenne-btn.selected {
            background: #64ffda;
            color: #0a192f;
        }
        
        /* INPUT AREA */
        .input-area {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        #numberInput {
            flex: 1;
            padding: 15px;
            background: #112240;
            border: 2px solid #64ffda;
            border-radius: 5px;
            color: #64ffda;
            font-size: 16px;
        }
        
        .action-btn {
            padding: 15px 25px;
            background: #64ffda;
            color: #0a192f;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
        }
        
        .action-btn:hover {
            background: #52d3aa;
        }
        
        /* CURRENT NUMBERS */
        .current-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            min-height: 80px;
            padding: 15px;
            background: rgba(10, 25, 47, 0.8);
            border-radius: 5px;
        }
        
        .number-tag {
            background: #233554;
            color: #64ffda;
            padding: 8px 15px;
            border-radius: 5px;
            border: 1px solid #64ffda;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .remove-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* RESULTS DISPLAY */
        .result-box {
            text-align: center;
            padding: 30px;
            background: rgba(10, 25, 47, 0.8);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .sum-display {
            font-size: 3em;
            font-weight: bold;
            color: #64ffda;
            margin-bottom: 20px;
            word-break: break-all;
        }
        
        .filters {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .filter-check {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: #233554;
            border-radius: 5px;
        }
        
        .filter-check input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }
        
        /* FILTER RESULTS */
        .filter-result {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .filter-pass {
            background: rgba(46, 204, 113, 0.2);
            border: 2px solid #2ecc71;
            color: #2ecc71;
        }
        
        .filter-fail {
            background: rgba(231, 76, 60, 0.2);
            border: 2px solid #e74c3c;
            color: #e74c3c;
        }
        
        /* QUICK ACTIONS */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .quick-btn {
            padding: 10px 20px;
            background: #233554;
            color: #64ffda;
            border: 1px solid #64ffda;
            border-radius: 5px;
            cursor: pointer;
            flex: 1;
            text-align: center;
        }
        
        .quick-btn:hover {
            background: #64ffda;
            color: #0a192f;
        }
        
        /* INSTRUCTIONS */
        .instructions {
            background: rgba(10, 25, 47, 0.8);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            border: 1px solid #233554;
        }
        
        .instructions h3 {
            color: #64ffda;
            margin-bottom: 15px;
        }
        
        .instructions ul {
            list-style: none;
            padding-left: 0;
        }
        
        .instructions li {
            padding: 8px 0;
            color: #8892b0;
            border-bottom: 1px solid #233554;
        }
        
        .instructions li:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßÆ Mersenne Sum Calculator</h1>
        <p class="subtitle">Add Mersenne exponents manually ‚Ä¢ Check prime filters in real-time</p>
        
        <div class="main-area">
            <div class="calculator">
                <h2 class="section-title">Mersenne Navigation</h2>
                <div class="mersenne-nav" id="mersenneNav">
                    <!-- Mersenne buttons will be added here by JavaScript -->
                </div>
                
                <h2 class="section-title">Add Numbers</h2>
                <div class="input-area">
                    <input type="text" id="numberInput" placeholder="Enter number or click M-buttons above">
                    <button class="action-btn" onclick="addNumber()">+ Add</button>
                </div>
                
                <div class="current-numbers" id="currentNumbers">
                    <!-- Numbers will appear here -->
                    <div style="color: #8892b0; text-align: center; width: 100%; padding: 20px;">
                        No numbers added yet
                    </div>
                </div>
                
                <div class="quick-actions">
                    <button class="quick-btn" onclick="clearAll()">üóëÔ∏è Clear All</button>
                    <button class="quick-btn" onclick="removeLast()">‚Ü∂ Remove Last</button>
                    <button class="quick-btn" onclick="calculateSum()">‚àë Calculate Sum</button>
                </div>
            </div>
            
            <div class="results">
                <h2 class="section-title">Results</h2>
                
                <div class="result-box">
                    <div class="sum-display" id="sumDisplay">0</div>
                    
                    <div class="filters">
                        <div class="filter-check">
                            <input type="checkbox" id="filterEndDigit" checked>
                            <label>Ends in 1,3,7,9</label>
                        </div>
                        <div class="filter-check">
                            <input type="checkbox" id="filterDigitalRoot" checked>
                            <label>Root ‚â† 3,6,9</label>
                        </div>
                    </div>
                    
                    <div id="filterResults">
                        <!-- Filter results will appear here -->
                    </div>
                </div>
                
                <h3 class="section-title">Recent Calculations</h3>
                <div id="recentCalculations">
                    <!-- Recent calculations will appear here -->
                </div>
            </div>
        </div>
        
        <div class="instructions">
            <h3>How to use:</h3>
            <ul>
                <li>1. Click M-buttons to add Mersenne exponents</li>
                <li>2. Or type numbers manually in the input field</li>
                <li>3. See the sum and filter results update in real-time</li>
                <li>4. Remove numbers by clicking the √ó button</li>
                <li>5. Use quick actions for common operations</li>
            </ul>
        </div>
    </div>

    <script>
        // All 52 Mersenne exponents with labels
        const MERSENNES = [
            {label: "M52", value: 136279841},
            {label: "M51", value: 82589933},
            {label: "M50", value: 77232917},
            {label: "M49", value: 74207281},
            {label: "M48", value: 57885161},
            {label: "M47", value: 43112609},
            {label: "M46", value: 42643801},
            {label: "M45", value: 37156667},
            {label: "M44", value: 32582657},
            {label: "M43", value: 30402457},
            {label: "M42", value: 25964951},
            {label: "M41", value: 24036583},
            {label: "M40", value: 20996011},
            {label: "M39", value: 13466917},
            {label: "M38", value: 6972593},
            {label: "M37", value: 3021377},
            {label: "M36", value: 2976221},
            {label: "M35", value: 1398269},
            {label: "M34", value: 1257787},
            {label: "M33", value: 859433},
            {label: "M32", value: 756839},
            {label: "M31", value: 216091},
            {label: "M30", value: 132049},
            {label: "M29", value: 110503},
            {label: "M28", value: 86243},
            {label: "M27", value: 44497},
            {label: "M26", value: 23209},
            {label: "M25", value: 21701},
            {label: "M24", value: 19937},
            {label: "M23", value: 11213},
            {label: "M22", value: 9941},
            {label: "M21", value: 9689},
            {label: "M20", value: 4423},
            {label: "M19", value: 4253},
            {label: "M18", value: 3217},
            {label: "M17", value: 2281},
            {label: "M16", value: 2203},
            {label: "M15", value: 1279},
            {label: "M14", value: 607},
            {label: "M13", value: 521},
            {label: "M12", value: 127},
            {label: "M11", value: 107},
            {label: "M10", value: 89},
            {label: "M09", value: 61},
            {label: "M08", value: 31},
            {label: "M07", value: 19},
            {label: "M06", value: 17},
            {label: "M05", value: 13},
            {label: "M04", value: 7},
            {label: "M03", value: 5},
            {label: "M02", value: 3},
            {label: "M01", value: 2}
        ];

        // State
        let currentNumbers = [];
        let recentCalculations = [];

        // Initialize Mersenne navigation
        function initializeMersenneNav() {
            const nav = document.getElementById('mersenneNav');
            MERSENNES.forEach(mersenne => {
                const button = document.createElement('button');
                button.className = 'mersenne-btn';
                button.textContent = mersenne.label;
                button.title = mersenne.value.toLocaleString();
                button.onclick = () => {
                    addNumber(mersenne.value);
                    // Highlight the button briefly
                    button.classList.add('selected');
                    setTimeout(() => button.classList.remove('selected'), 300);
                };
                nav.appendChild(button);
            });
        }

        // Add a number to the list
        function addNumber(value = null) {
            const input = document.getElementById('numberInput');
            let num;
            
            if (value !== null) {
                num = value;
            } else {
                num = parseInt(input.value.trim());
                if (isNaN(num) || num <= 0) {
                    alert('Please enter a valid positive number');
                    return;
                }
            }
            
            currentNumbers.push(num);
            updateDisplay();
            calculateSum();
            
            // Clear input if manually typed
            if (value === null) {
                input.value = '';
                input.focus();
            }
        }

        // Remove a number
        function removeNumber(index) {
            currentNumbers.splice(index, 1);
            updateDisplay();
            calculateSum();
        }

        // Update the display of current numbers
        function updateDisplay() {
            const container = document.getElementById('currentNumbers');
            
            if (currentNumbers.length === 0) {
                container.innerHTML = '<div style="color: #8892b0; text-align: center; width: 100%; padding: 20px;">No numbers added yet</div>';
                return;
            }
            
            container.innerHTML = '';
            currentNumbers.forEach((num, index) => {
                const tag = document.createElement('div');
                tag.className = 'number-tag';
                tag.innerHTML = `
                    ${num.toLocaleString()}
                    <button class="remove-btn" onclick="removeNumber(${index})">√ó</button>
                `;
                container.appendChild(tag);
            });
        }

        // Calculate digital root
        function calculateDigitalRoot(num) {
            let n = num;
            while (n >= 10) {
                let sum = 0;
                while (n > 0) {
                    sum += n % 10;
                    n = Math.floor(n / 10);
                }
                n = sum;
            }
            return n;
        }

        // Check if number passes filters
        function checkFilters(num) {
            const results = [];
            
            // Check end digit
            const lastDigit = num % 10;
            const endDigitValid = [1, 3, 7, 9].includes(lastDigit);
            results.push({
                name: 'End Digit',
                value: lastDigit,
                passed: endDigitValid,
                required: '1, 3, 7, or 9'
            });
            
            // Check digital root
            const digitalRoot = calculateDigitalRoot(num);
            const rootValid = ![3, 6, 9].includes(digitalRoot);
            results.push({
                name: 'Digital Root',
                value: digitalRoot,
                passed: rootValid,
                required: 'Not 3, 6, or 9'
            });
            
            return results;
        }

        // Calculate and display sum
        function calculateSum() {
            const sum = currentNumbers.reduce((a, b) => a + b, 0);
            const sumDisplay = document.getElementById('sumDisplay');
            sumDisplay.textContent = sum.toLocaleString();
            
            // Check filters
            const filterEndDigit = document.getElementById('filterEndDigit').checked;
            const filterDigitalRoot = document.getElementById('filterDigitalRoot').checked;
            const filterResultsDiv = document.getElementById('filterResults');
            
            let allPassed = true;
            let filterResultsHTML = '';
            
            const filterChecks = checkFilters(sum);
            
            filterChecks.forEach(check => {
                // Only check if the filter is enabled
                let passed = true;
                let shouldCheck = true;
                
                if (check.name === 'End Digit' && !filterEndDigit) {
                    shouldCheck = false;
                }
                if (check.name === 'Digital Root' && !filterDigitalRoot) {
                    shouldCheck = false;
                }
                
                if (shouldCheck) {
                    passed = check.passed;
                    if (!passed) allPassed = false;
                }
                
                filterResultsHTML += `
                    <div class="filter-result ${passed ? 'filter-pass' : 'filter-fail'}">
                        ${check.name}: ${check.value} ${shouldCheck ? (passed ? '‚úì' : `‚úó (should be ${check.required})`) : '(filter off)'}
                    </div>
                `;
            });
            
            // Overall result
            filterResultsHTML += `
                <div class="filter-result ${allPassed ? 'filter-pass' : 'filter-fail'}" style="margin-top: 15px; font-size: 1.2em;">
                    ${allPassed ? '‚úÖ ALL FILTERS PASSED - Prime Candidate!' : '‚ùå FAILED SOME FILTERS'}
                </div>
            `;
            
            filterResultsDiv.innerHTML = filterResultsHTML;
            
            // Add to recent calculations if we have numbers
            if (currentNumbers.length > 0 && sum > 0) {
                addToRecent(sum);
            }
        }

        // Add calculation to recent
        function addToRecent(sum) {
            const calculation = {
                numbers: [...currentNumbers],
                sum: sum,
                timestamp: new Date().toLocaleTimeString(),
                passed: checkFilters(sum).every(check => check.passed)
            };
            
            recentCalculations.unshift(calculation);
            if (recentCalculations.length > 5) {
                recentCalculations.pop();
            }
            
            updateRecentCalculations();
        }

        // Update recent calculations display
        function updateRecentCalculations() {
            const container = document.getElementById('recentCalculations');
            
            if (recentCalculations.length === 0) {
                container.innerHTML = '<div style="color: #8892b0; text-align: center; padding: 20px;">No recent calculations</div>';
                return;
            }
            
            let html = '';
            recentCalculations.forEach((calc, index) => {
                html += `
                    <div class="filter-result ${calc.passed ? 'filter-pass' : 'filter-fail'}" style="margin-bottom: 10px;">
                        <strong>${calc.numbers.map(n => n.toLocaleString()).join(' + ')}</strong><br>
                        = ${calc.sum.toLocaleString()}<br>
                        <small>${calc.timestamp} ${calc.passed ? '‚úì' : '‚úó'}</small>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Clear all numbers
        function clearAll() {
            currentNumbers = [];
            updateDisplay();
            calculateSum();
        }

        // Remove last number
        function removeLast() {
            if (currentNumbers.length > 0) {
                currentNumbers.pop();
                updateDisplay();
                calculateSum();
            }
        }

        // Initialize
        window.onload = function() {
            initializeMersenneNav();
            updateDisplay();
            calculateSum();
            
            // Auto-update when filters change
            document.getElementById('filterEndDigit').addEventListener('change', calculateSum);
            document.getElementById('filterDigitalRoot').addEventListener('change', calculateSum);
            
            // Allow pressing Enter in input
            document.getElementById('numberInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addNumber();
                }
            });
        };

        console.log("Mersenne Sum Calculator loaded");
    </script>
</body>
</html>
